	ORG 0000H
	AJMP MAIN
	ORG 0030H
MAIN:
	MOV P3,#00H
	MOV P2,#0FFH
	MOV R0,#00H
	MOV R7,#0F7H
HAVEKEY:
	MOV P2,#0F0H
	MOV A,P2
	XRL A,#0F0H
	JZ HAVEKEY		; A=0 -> KEYLP1
	ACALL DELAY
	MOV P2,#0F0H
	MOV A,P2
	XRL A,#0F0H
	JZ HAVEKEY
	
	MOV P2,R1
	MOV A,P2		;读P2口
	JB ACC.4,NEXT1  ; 判断ACC.4这一列是否有按键按下
	MOV R0,#00H
	SJMP DISPLAY
NEXT1:
	JB ACC.5,NEXT2
	ACALL DELAY
	JB ACC.5,NEXT2
	MOV R0,#02H
	SJMP DISPLAY
NEXT2:
	JB ACC.6,NEXT3
NEXT3:
	JB ACC.7,NEXT4
NEXT4:
	
	
	
DISPLAY:
	MOV A,R0
	MOV DPTR,#TAB
	MOVC A,@A+DPTR
	MOV P3,A
	SJMP HAVEKEY
	; MOV R0,#00H
	; MOV R1,#0F7H ; init P2	
	
	
	
DELAY: 
	MOV B,#14H	;delay 20ms
DL0:	
	MOV R1,#0FAH ; 250*4 
DL1:
	NOP
	NOP
	DJNZ R1,DL1
	DJNZ B,DL0
	RET
	
TAB: 
	DB       3FH,  06H,  5BH,  4FH  ;0, 1, 2, 3
	DB       66H,  6DH,  7DH,  07H  ;4, 5, 6, 7
	DB       7FH,  6FH,  77H,  7CH  ;8, 9, A, B
	DB       39H,  5EH,  79H,  7EH  ;C, D, E, F
	END